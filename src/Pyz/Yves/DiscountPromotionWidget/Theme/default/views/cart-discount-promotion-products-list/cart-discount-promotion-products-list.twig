{% extends template('widget') %}

{% define data = {
    promotionProducts: _widget.promotionProducts
} %}

{% block body %}
    {% if data.promotionProducts is not empty %}
        <h4 class="title title--promotion title--medium title--with-border">{{ 'cart.promotion.items' | trans }}</h4>

        {% for product in data.promotionProducts %}
            {% embed molecule('product-item') with {
                modifiers: ['promotional'],
                data: {
                    product: product,
                },
                embed: {
                    promotionDiscount: {
                        id: product.promotionItem.discount.discountPromotion.idDiscountPromotion,
                        maxQuantity: product.promotionItem.maxQuantity
                    },
                },
            } only %}
                {% block productThumbnail %}
                    {% set modifiers = ['small'] %}

                    {{ parent() }}
                {% endblock %}

                {% block content %}
                    <div class="col col--expand spacing-left spacing-left--inner spacing-left--big">
                        {{ parent() }}

                        <div class="grid">
                            {% include molecule('variant-configurator', 'DiscountPromotionWidget') with {
                                class: 'col col--lg-9 col--sm-12',
                                data: {
                                    sku: data.sku,
                                    superAttributes: data.product.attributeMap.superAttributes,
                                    selectedAttributes: data.product.selectedAttributes,
                                    availableAttributes: data.product.availableAttributes,
                                },
                            } only %}
                        </div>

                        <form method="POST" action="/cart/add/{{ data.sku }}" class="grid grid--bottom grid--justify">
                            {% set disabledAttribute = data.product.idProductConcrete is empty ? 'disabled' %}

                            {% include molecule('product-quantity-input') with {
                                data: {
                                    maxQuantity: embed.promotionDiscount.maxQuantity,
                                    hasUpdateButton: false,
                                },
                            } only %}

                            <div class="col col--sm-12 col--md-4 text-right">
                                <input type="hidden" value="{{ data.sku }}" name="groupKey">
                                <input type="hidden" value="{{ embed.promotionDiscount.id }}" name="idDiscountPromotion">

                                <button class="button button--hollow button--promotion-item" {{ disabledAttribute }} data-init-single-click>
                                    {{ 'page.detail.add-to-cart' | trans }}
                                </button>
                            </div>
                        </form>
                    </div>
                {% endblock %}
            {% endembed %}
        {% endfor %}
    {% endif %}
{% endblock %}
